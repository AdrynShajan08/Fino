{% extends "layout.html" %}
{% block content %}
<div class="container mt-4">
  <h3 class="mb-4">ðŸ‘¤ Profile Settings</h3>

  <div class="row">
    <!-- LEFT COLUMN -->
    <div class="col-md-6">
      <div class="card p-3 mb-3">
        <h5 class="mb-3">ðŸ’° Financial Summary</h5>
        <p><strong>Total Expenses:</strong> â‚¹{{ '%.2f'|format(total_expenses) }}</p>
        <p><strong>Total Investments:</strong> â‚¹{{ '%.2f'|format(total_investments) }}</p>
      </div>

      <div class="card p-3">
        <h5 class="mb-3">ðŸ”‘ Update Password</h5>
        {% if error %}
          <div class="alert alert-danger">{{ error }}</div>
        {% endif %}
        {% if message %}
          <div class="alert alert-success">{{ message }}</div>
        {% endif %}
        <form method="POST">
          <div class="mb-3">
            <label class="form-label">Current Password</label>
            <input type="password" name="current_password" class="form-control" required>
          </div>
          <div class="mb-3">
            <label class="form-label">New Password</label>
            <input type="password" name="new_password" class="form-control" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Confirm New Password</label>
            <input type="password" name="confirm_password" class="form-control" required>
          </div>
          <button class="btn btn-dark">Update Password</button>
        </form>
      </div>
    </div>

    <!-- RIGHT COLUMN -->
    <!-- <div class="col-md-6">
      <div class="card p-3">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <h5 class="mb-0">ðŸ“ˆ Investment Growth Trend</h5>
          <select id="trendPeriod" class="form-select form-select-sm" style="width:auto;">
            <option value="month" selected>Monthly</option>
            <option value="year">Yearly</option>
          </select>
        </div>
        <canvas id="investmentTrendChart" height="200"></canvas>
      </div>
    </div> -->
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const ctx = document.getElementById('investmentTrendChart');
let trendChart;

function fetchTrend(period = 'month') {
  fetch(`/get_investment_trend?period=${period}`)
    .then(res => res.json())
    .then(data => {
      if (trendChart) trendChart.destroy();

      trendChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: data.labels,
          datasets: [{
            label: 'Total Investments (â‚¹)',
            data: data.values,
            borderColor: '#0d6efd',
            tension: 0.3,
            fill: false,
            pointRadius: 4,
            pointBackgroundColor: '#0d6efd'
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { display: true },
          },
          scales: {
            x: { title: { display: true, text: period === 'year' ? 'Year' : 'Month' } },
            y: { title: { display: true, text: 'Investment Value (â‚¹)' } }
          }
        }
      });
    });
}

document.getElementById('trendPeriod').addEventListener('change', e => {
  fetchTrend(e.target.value);
});

fetchTrend(); // Initial load
</script>
{% endblock %}
