{% extends "layout.html" %}
{% block content %}
<div class="container mt-4">
  <h3 class="mb-4">ðŸ“Š Dashboard</h3>

  <div class="row g-4">
    <!-- Spending Summary -->
    <div class="col-md-6">
      <div class="card p-3">
        <h5 class="mb-3">ðŸ’¸ Spending by Category</h5>
        <canvas id="expenseChart" height="200"></canvas>
      </div>
    </div>

    <!-- Investment Trend -->
    <div class="col-md-6">
      <div class="card p-3">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <h5 class="mb-0">ðŸ“ˆ Investment Growth Trend</h5>
          <select id="trendPeriod" class="form-select form-select-sm" style="width:auto;">
            <option value="month" selected>Monthly</option>
            <option value="year">Yearly</option>
          </select>
        </div>
        <canvas id="investmentTrendChart" height="200"></canvas>
      </div>
    </div>
  </div>
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
let expenseChart;
let investmentChart;

function loadExpenseSummary() {
  fetch('/get_summary')
    .then(res => res.json())
    .then(data => {
      const ctx = document.getElementById('expenseChart');
      if (expenseChart) expenseChart.destroy();
      expenseChart = new Chart(ctx, {
        type: 'pie',
        data: {
          labels: data.labels,
          datasets: [{
            data: data.values,
            backgroundColor: ['#0d6efd', '#198754', '#ffc107', '#dc3545', '#20c997', '#6f42c1', '#fd7e14']
          }]
        },
        options: {
          plugins: {
            legend: { position: 'bottom' }
          }
        }
      });
    });
}

function loadInvestmentTrend(period = 'month') {
  fetch(`/get_investment_trend?period=${period}`)
    .then(res => res.json())
    .then(data => {
      const ctx = document.getElementById('investmentTrendChart');
      if (investmentChart) investmentChart.destroy();
      investmentChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: data.labels,
          datasets: [{
            label: 'Total Investments (â‚¹)',
            data: data.values,
            borderColor: '#0d6efd',
            tension: 0.3,
            fill: false,
            pointRadius: 4,
            pointBackgroundColor: '#0d6efd'
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { display: true }
          },
          scales: {
            x: { title: { display: true, text: period === 'year' ? 'Year' : 'Month' } },
            y: { title: { display: true, text: 'Investment Value (â‚¹)' } }
          }
        }
      });
    });
}

document.getElementById('trendPeriod').addEventListener('change', e => {
  loadInvestmentTrend(e.target.value);
});

loadExpenseSummary();
loadInvestmentTrend();
</script>
{% endblock %}
